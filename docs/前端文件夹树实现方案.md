# å‰ç«¯æ–‡ä»¶å¤¹æ ‘å®ç°æ–¹æ¡ˆ

## æ¦‚è¿°
å½“å‰å‰ç«¯çš„"é€‰æ‹©æ–‡ä»¶"å¯¹è¯æ¡†ä½¿ç”¨å¹³é“ºæ–¹å¼æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼Œéœ€è¦å‡çº§ä¸ºæ”¯æŒåˆ†å±‚æ–‡ä»¶å¤¹çš„æ ‘å½¢æ˜¾ç¤ºã€‚

## å®ç°ç›®æ ‡
1. åœ¨æ•°æ®ç®¡ç†ä¸­å¿ƒå’Œåœ°è´¨å»ºæ¨¡ä¸­å¿ƒçš„æ–‡ä»¶é€‰æ‹©å™¨ä¸­æ˜¾ç¤ºæ–‡ä»¶å¤¹å±‚çº§ç»“æ„
2. æ”¯æŒåˆ›å»ºã€å±•å¼€/æŠ˜å æ–‡ä»¶å¤¹
3. æ”¯æŒå°†æ–‡ä»¶ä¸Šä¼ åˆ°æŒ‡å®šæ–‡ä»¶å¤¹

## æŠ€æœ¯æ–¹æ¡ˆ

### 1. æ•°æ®ç»“æ„è®¾è®¡

```typescript
interface FolderNode {
  path: string;          // æ–‡ä»¶å¤¹è·¯å¾„ï¼Œå¦‚ "input/data"
  name: string;          // æ–‡ä»¶å¤¹åç§°
  children: (FolderNode | FileItem)[];  // å­èŠ‚ç‚¹
  type: 'folder';
  expanded?: boolean;    // æ˜¯å¦å±•å¼€
}

interface FileTreeData {
  root: FolderNode;
  fileCount: number;
  folderCount: number;
}
```

### 2. APIè°ƒç”¨æ›´æ–°

```typescript
// è·å–æ–‡ä»¶å¤¹æ ‘ç»“æ„
const fetchFolderTree = async () => {
  const response = await fetch(`${apiBaseUrl}/api/v1/files/folders/tree`);
  const data = await response.json();
  return buildTreeStructure(data.folders);
};

// æ„å»ºæ ‘å½¢ç»“æ„
const buildTreeStructure = (folders: string[]): FolderNode => {
  const root: FolderNode = {
    path: '',
    name: 'Root',
    type: 'folder',
    children: [],
    expanded: true
  };
  
  // å°†æ–‡ä»¶æŒ‰æ–‡ä»¶å¤¹åˆ†ç»„
  const filesByFolder = new Map<string, FileItem[]>();
  
  // æ„å»ºæ–‡ä»¶å¤¹æ ‘...
  return root;
};
```

### 3. UIç»„ä»¶å®ç°

```typescript
// TreeViewç»„ä»¶
const FileTreeView: React.FC<{
  data: FolderNode;
  selectedFiles: Set<string>;
  onFileSelect: (fileId: string) => void;
  onFolderCreate?: (parentPath: string) => void;
}> = ({ data, selectedFiles, onFileSelect, onFolderCreate }) => {
  const [expanded, setExpanded] = useState<Set<string>>(new Set(['']));
  
  const toggleFolder = (path: string) => {
    const newExpanded = new Set(expanded);
    if (newExpanded.has(path)) {
      newExpanded.delete(path);
    } else {
      newExpanded.add(path);
    }
    setExpanded(newExpanded);
  };
  
  const renderNode = (node: FolderNode | FileItem, level: number = 0) => {
    if (node.type === 'folder') {
      return (
        <div key={node.path} style={{ marginLeft: level * 20 }}>
          <div 
            className="folder-header"
            onClick={() => toggleFolder(node.path)}
          >
            {expanded.has(node.path) ? 'ğŸ“‚' : 'ğŸ“'} {node.name}
            <span className="file-count">({node.children.length})</span>
          </div>
          {expanded.has(node.path) && (
            <div className="folder-content">
              {node.children.map(child => renderNode(child, level + 1))}
            </div>
          )}
        </div>
      );
    } else {
      // æ¸²æŸ“æ–‡ä»¶èŠ‚ç‚¹
      return (
        <div 
          key={node.file_id} 
          style={{ marginLeft: (level + 1) * 20 }}
          className={`file-item ${selectedFiles.has(node.file_id) ? 'selected' : ''}`}
          onClick={() => onFileSelect(node.file_id)}
        >
          <Checkbox checked={selectedFiles.has(node.file_id)} />
          {getFileIcon(node.file_type, node.file_name)}
          <span>{node.file_name}</span>
        </div>
      );
    }
  };
  
  return <div className="file-tree">{renderNode(data)}</div>;
};
```

### 4. æ›´æ–°ç°æœ‰ç»„ä»¶

ä¿®æ”¹ `GeologicalModelingHub.tsx` ä¸­çš„æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†ï¼š

```typescript
// åœ¨å¯¹è¯æ¡†ä¸­ä½¿ç”¨æ ‘å½¢è§†å›¾
<DialogContent className="max-w-4xl max-h-[80vh] overflow-y-auto">
  <DialogHeader>
    <DialogTitle>ä»æ•°æ®ç®¡ç†ä¸­å¿ƒé€‰æ‹©æ–‡ä»¶</DialogTitle>
    <Button 
      size="sm" 
      variant="outline"
      onClick={() => setShowCreateFolder(true)}
    >
      <FolderPlus className="h-3 w-3 mr-1" />
      æ–°å»ºæ–‡ä»¶å¤¹
    </Button>
  </DialogHeader>
  
  <div className="mt-4">
    {folderTreeLoading ? (
      <div>åŠ è½½æ–‡ä»¶å¤¹ç»“æ„...</div>
    ) : (
      <FileTreeView
        data={folderTree}
        selectedFiles={selectedForImport}
        onFileSelect={handleImportFileSelect}
        onFolderCreate={handleCreateFolder}
      />
    )}
  </div>
  
  <div className="flex justify-end space-x-2 pt-4 border-t">
    <Button variant="outline" onClick={() => setShowFileSelector(false)}>
      å–æ¶ˆ
    </Button>
    <Button 
      onClick={importSelectedFiles}
      disabled={selectedForImport.size === 0 || importLoading}
    >
      {importLoading ? 'å¯¼å…¥ä¸­...' : `å¯¼å…¥ ${selectedForImport.size} ä¸ªæ–‡ä»¶`}
    </Button>
  </div>
</DialogContent>
```

### 5. æ ·å¼å®šä¹‰

```css
.file-tree {
  max-height: 500px;
  overflow-y: auto;
  border: 1px solid #e5e7eb;
  border-radius: 6px;
  padding: 12px;
}

.folder-header {
  display: flex;
  align-items: center;
  cursor: pointer;
  padding: 4px 8px;
  border-radius: 4px;
  user-select: none;
}

.folder-header:hover {
  background-color: #f3f4f6;
}

.file-count {
  margin-left: 8px;
  color: #6b7280;
  font-size: 12px;
}

.file-item {
  display: flex;
  align-items: center;
  padding: 4px 8px;
  cursor: pointer;
  border-radius: 4px;
}

.file-item:hover {
  background-color: #f3f4f6;
}

.file-item.selected {
  background-color: #dbeafe;
}
```

## å®æ–½æ­¥éª¤

1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šå®ç°åŸºç¡€æ ‘å½¢æ˜¾ç¤º
   - åˆ›å»ºFileTreeViewç»„ä»¶
   - é›†æˆåˆ°ç°æœ‰çš„æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
   - æµ‹è¯•åŸºæœ¬çš„å±•å¼€/æŠ˜å åŠŸèƒ½

2. **ç¬¬äºŒé˜¶æ®µ**ï¼šæ·»åŠ æ–‡ä»¶å¤¹æ“ä½œ
   - å®ç°åˆ›å»ºæ–‡ä»¶å¤¹åŠŸèƒ½
   - æ”¯æŒæ‹–æ‹½æ–‡ä»¶åˆ°æ–‡ä»¶å¤¹
   - æ‰¹é‡æ“ä½œæ”¯æŒ

3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šä¼˜åŒ–ä½“éªŒ
   - æ·»åŠ æœç´¢è¿‡æ»¤åŠŸèƒ½
   - è®°ä½ç”¨æˆ·çš„å±•å¼€çŠ¶æ€
   - æ€§èƒ½ä¼˜åŒ–ï¼ˆè™šæ‹Ÿæ»šåŠ¨ï¼‰

## é¢„æœŸæ•ˆæœ

å®Œæˆåï¼Œç”¨æˆ·å°†èƒ½å¤Ÿï¼š
- çœ‹åˆ°æ¸…æ™°çš„æ–‡ä»¶å¤¹å±‚çº§ç»“æ„
- å¿«é€Ÿå®šä½å’Œé€‰æ‹©éœ€è¦çš„æ–‡ä»¶
- åˆ›å»ºè‡ªå®šä¹‰çš„æ–‡ä»¶å¤¹ç»„ç»‡ç»“æ„
- æ‰¹é‡ä¸Šä¼ æ–‡ä»¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹

è¿™å°†å¤§å¤§æå‡æ–‡ä»¶ç®¡ç†çš„æ•ˆç‡å’Œç”¨æˆ·ä½“éªŒã€‚ 